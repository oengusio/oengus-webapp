<h1>Saved Speedrun settings</h1>

<div style="margin-bottom: 2em">
  <!-- TODO: hide text for supporters -->
  <p>If you are supporting Oengus on patreon you will be able to modify your saved runs here.</p>

  <!-- text for all -->
  <p>Saved speedruns can be shown off on your profile (toggleable in account settings) and autofillable when submitting
    to
    events.</p>

  <p>Any changes you make here might take <strong>24 hours</strong> to update on your profile. Do not worry, autofill is
    unaffected.</p>
</div>

<div class="box is-relative">
  <p class="is-pulled-left">{{ 'marathon.submit.table.games' | translate }}</p>
  <button
    type="button"
    class="button is-small is-primary is-pulled-left"
    style="margin-left: 5px"
    (click)="addGame()"
    [disabled]="!isSupporter"
  >
    <fa-icon [icon]="faPlus"></fa-icon>
  </button>
  <div class="is-clearfix"></div>

  <form action="" ngForm="submitForm" #form="ngForm">
    <fieldset [disabled]="!isSupporter">
      @for (game of games; track game.id; let i = $index; ) {
        <hr class="has-background-grey"/>

        <button class="delete is-absolute" style="right: 10px;" (click)="removeGame(i)"></button>

        <div class="columns is-multiline">
          <div class="column is-half">
            <div class="field">
              <label for="gameName{{i}}" class="label">
                {{ 'marathon.submit.game.name.label' | translate }}
              </label>

              <div class="control">
                <input
                  type="text"
                  [(ngModel)]="game.name"
                  class="input"
                  id="gameName{{i}}"
                  name="gameName{{i}}"
                  [ngClass]="{'is-danger': gameName.invalid}"
                  required
                  maxlength="100"
                  #gameName="ngModel"
                />
                <p class="help is-pulled-right">{{ game.name?.length }}/100</p>
              </div>

              @if (gameName.invalid) {
                <div>
                  @if (gameName.errors.required) {
                    <p class="help is-danger">
                      {{ 'marathon.submit.game.name.error.required' | translate }}</p>
                  }
                </div>
              }
            </div>
          </div>

          <div class="column is-half">
            <div class="field">
              <label for="gameRatio{{i}}" class="label">
                {{ 'marathon.submit.game.ratio.label' | translate }}
              </label>

              <div class="control">
                <input
                  type="text"
                  class="input"
                  [(ngModel)]="game.ratio"
                  id="gameRatio{{i}}"
                  name="gameRatio{{i}}"
                  [ngClass]="{'is-danger': gameRatio.invalid}"
                  required
                  maxlength="10"
                  #gameRatio="ngModel"
                />
                <p class="help is-pulled-right">{{ game.ratio?.length }}/10</p>
              </div>

              @if (gameRatio.invalid) {
                <div>
                  @if (gameRatio.errors.required) {
                    <p class="help is-danger">
                      {{ 'marathon.submit.game.ratio.error.required' | translate }}</p>
                  }
                </div>
              }
            </div>
          </div>

          <div class="column">
            <label for="gameConsole{{i}}" class="label">
              {{ 'marathon.submit.game.console.label' | translate }}
            </label>

            <div class="field has-addons">
              <div class="select is-fullwidth">
                <select [(ngModel)]="game.console" name="gameConsole{{i}}" id="gameConsole{{i}}">
                  <option value="" disabled>(select a game)</option>
                  @for (opt of possibleConsoles; track opt) {
                    <option [ngValue]="opt">{{ opt }}</option>
                  }
                </select>
              </div>

              <p class="control">
                <button type="button" class="button">
                  <label class="checkbox" for="emulated{{i}}">
                    <input
                      type="checkbox"
                      [checked]="game.emulated"
                      [(ngModel)]="game.emulated"
                      name="emulated{{i}}"
                      id="emulated{{i}}"
                      style="margin-right: 0.25rem"
                    />
                    {{ 'marathon.submit.game.console.emulated' | translate }}
                  </label>
                </button>
              </p>
            </div>
          </div>
        </div>

        <div class="field">
          <label for="gameDescription{{i}}" class="label">
            {{ 'marathon.submit.game.description.label' | translate }}
          </label>
          <p class="help">{{ 'marathon.submit.game.description.help' | translate }}</p>

          <div class="control">
            <textarea
              name="gameDescription{{i}}"
              id="gameDescription{{i}}"
              cols="30"
              rows="10"
              class="textarea"
              [(ngModel)]="game.description"
              [ngClass]="{'is-danger': gameDescription.invalid}"
              required
              #gameDescription="ngModel">
            ></textarea>
          </div>
          @if (gameDescription.invalid) {
            <div>
              @if (gameDescription.errors.required) {
                <p class="help is-danger">
                  {{ 'marathon.submit.game.description.error.required' | translate }}</p>
              }
            </div>
          }
        </div>

        <hr class="has-background-grey-darker"/>

        <div class="columns is-multiline">
          @for (category of game.categories; track category.id; let j = $index; ) {
            <div class="column is-full-touch" [ngClass]="{ 'is-half': (game.categories.length > 1) }">
              <article class="message">
                TODO: simplified category editor for {{ category.name }}
              </article>
            </div>

            // .is-half-desktop
              // .is-full-mobile
          }
        </div>
      }
    </fieldset>
  </form>
</div>
